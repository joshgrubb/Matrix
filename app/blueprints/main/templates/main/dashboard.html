{% extends "base.html" %}

{% block title %}Dashboard — PositionMatrix{% endblock %}

{% block content %}
<div class="pm-page-header">
    <div>
        <h1>Dashboard</h1>
        <p>Welcome back, {{ current_user.full_name }}. Here's your workspace.</p>
    </div>
</div>

{# ── Quick-access feature cards ── #}
<div class="row g-3 mb-4">

    {# -- Organization card — visible to all authenticated users -- #}
    <div class="col-md-6 col-lg-4">
        <div class="pm-card pm-card-hover h-100">
            <div class="pm-feature-card">
                <div class="pm-feature-icon pm-stat-icon--blue">
                    <i class="bi bi-diagram-3"></i>
                </div>
                <h3>Organization</h3>
                <p>View departments, divisions, and positions synced from NeoGov.</p>
                <a href="{{ url_for('organization.departments') }}" class="pm-btn pm-btn-primary pm-btn-sm mt-auto">
                    <i class="bi bi-arrow-right"></i>
                    Browse Departments
                </a>
            </div>
        </div>
    </div>

    {# -- Requirements card — admin, IT staff, and managers only -- #}
    {% if current_user.has_role('admin', 'it_staff', 'manager') %}
    <div class="col-md-6 col-lg-4">
        <div class="pm-card pm-card-hover h-100">
            <div class="pm-feature-card">
                <div class="pm-feature-icon" style="background: var(--pm-success-bg); color: var(--pm-success);">
                    <i class="bi bi-list-check"></i>
                </div>
                <h3>Requirements</h3>
                <p>Configure hardware and software requirements for positions.</p>
                <a href="{{ url_for('requirements.select_position') }}" class="pm-btn pm-btn-primary pm-btn-sm mt-auto">
                    <i class="bi bi-arrow-right"></i>
                    Manage Requirements
                </a>
            </div>
        </div>
    </div>
    {% endif %}

    {# -- Reports card — visible to all authenticated users -- #}
    <div class="col-md-6 col-lg-4">
        <div class="pm-card pm-card-hover h-100">
            <div class="pm-feature-card">
                <div class="pm-feature-icon" style="background: var(--pm-warning-bg); color: var(--pm-warning);">
                    <i class="bi bi-bar-chart-line"></i>
                </div>
                <h3>Reports</h3>
                <p>View cost summaries and export data by department.</p>
                <a href="{{ url_for('reports.cost_summary') }}" class="pm-btn pm-btn-primary pm-btn-sm mt-auto">
                    <i class="bi bi-arrow-right"></i>
                    View Reports
                </a>
            </div>
        </div>
    </div>

</div>

{# ── Secondary action cards ── #}
<div class="row g-3">

    {# -- Equipment Catalog — admin and IT staff only -- #}
    {% if current_user.has_role('admin', 'it_staff') %}
    <div class="col-md-6">
        <div class="pm-card">
            <div class="card-header">
                <i class="bi bi-cpu me-2"></i>Equipment Catalog
            </div>
            <div class="card-body">
                <p class="pm-text-muted mb-3">
                    Manage the hardware types and software products available for assignment to positions.
                </p>
                <div class="d-flex flex-wrap gap-2">
                    <a href="{{ url_for('equipment.hardware_list') }}" class="pm-btn pm-btn-secondary pm-btn-sm">
                        <i class="bi bi-pc-display"></i>
                        Hardware Types
                    </a>
                    <a href="{{ url_for('equipment.software_list') }}" class="pm-btn pm-btn-secondary pm-btn-sm">
                        <i class="bi bi-window-stack"></i>
                        Software Products
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    {# -- Admin panel — admin and IT staff -- #}
    {% if current_user.has_role('admin', 'it_staff') %}
    <div class="col-md-6">
        <div class="pm-card">
            <div class="card-header">
                <i class="bi bi-shield-lock me-2"></i>Administration
            </div>
            <div class="card-body">
                <p class="pm-text-muted mb-3">
                    {% if current_user.has_role('admin') %}
                    Manage users, view audit logs, and trigger HR synchronization jobs.
                    {% else %}
                    View audit logs and trigger HR synchronization jobs.
                    {% endif %}
                </p>
                <div class="d-flex flex-wrap gap-2">
                    {% if current_user.has_role('admin') %}
                    <a href="{{ url_for('admin.manage_users') }}" class="pm-btn pm-btn-secondary pm-btn-sm">
                        <i class="bi bi-people"></i>
                        Users
                    </a>
                    {% endif %}
                    <a href="{{ url_for('admin.audit_logs') }}" class="pm-btn pm-btn-secondary pm-btn-sm">
                        <i class="bi bi-journal-text"></i>
                        Audit Logs
                    </a>
                    <a href="{{ url_for('admin.hr_sync') }}" class="pm-btn pm-btn-secondary pm-btn-sm">
                        <i class="bi bi-arrow-repeat"></i>
                        HR Sync
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

</div>
{% endblock %}